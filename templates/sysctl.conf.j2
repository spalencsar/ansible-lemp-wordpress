# System optimization configuration for WordPress/LEMP stack
# Generated by Ansible

# Network optimizations
net.core.rmem_default = {{ net_core_rmem_default | default('262144') }}
net.core.rmem_max = {{ net_core_rmem_max | default('16777216') }}
net.core.wmem_default = {{ net_core_wmem_default | default('262144') }}
net.core.wmem_max = {{ net_core_wmem_max | default('16777216') }}
net.core.netdev_max_backlog = {{ net_core_netdev_max_backlog | default('5000') }}
net.core.somaxconn = {{ net_core_somaxconn | default('1024') }}

# TCP optimizations
net.ipv4.tcp_window_scaling = {{ net_ipv4_tcp_window_scaling | default('1') }}
net.ipv4.tcp_congestion_control = {{ net_ipv4_tcp_congestion_control | default('bbr') }}
net.ipv4.tcp_rmem = {{ net_ipv4_tcp_rmem | default('4096 87380 16777216') }}
net.ipv4.tcp_wmem = {{ net_ipv4_tcp_wmem | default('4096 65536 16777216') }}
net.ipv4.tcp_max_syn_backlog = {{ net_ipv4_tcp_max_syn_backlog | default('8192') }}
net.ipv4.tcp_slow_start_after_idle = {{ net_ipv4_tcp_slow_start_after_idle | default('0') }}
net.ipv4.tcp_tw_reuse = {{ net_ipv4_tcp_tw_reuse | default('1') }}

# Memory management
vm.swappiness = {{ vm_swappiness | default('10') }}
vm.dirty_ratio = {{ vm_dirty_ratio | default('15') }}
vm.dirty_background_ratio = {{ vm_dirty_background_ratio | default('5') }}
vm.vfs_cache_pressure = {{ vm_vfs_cache_pressure | default('50') }}
vm.min_free_kbytes = {{ vm_min_free_kbytes | default('65536') }}

# File system optimizations
fs.file-max = {{ fs_file_max | default('1000000') }}
fs.inotify.max_user_watches = {{ fs_inotify_max_user_watches | default('524288') }}

# Security optimizations
net.ipv4.conf.all.rp_filter = {{ net_ipv4_conf_all_rp_filter | default('1') }}
net.ipv4.conf.default.rp_filter = {{ net_ipv4_conf_default_rp_filter | default('1') }}
net.ipv4.icmp_echo_ignore_broadcasts = {{ net_ipv4_icmp_echo_ignore_broadcasts | default('1') }}
net.ipv4.icmp_ignore_bogus_error_responses = {{ net_ipv4_icmp_ignore_bogus_error_responses | default('1') }}
net.ipv4.conf.all.log_martians = {{ net_ipv4_conf_all_log_martians | default('1') }}
net.ipv4.conf.default.log_martians = {{ net_ipv4_conf_default_log_martians | default('1') }}

# Process limits
kernel.pid_max = {{ kernel_pid_max | default('4194304') }}
